"use strict";(self.webpackChunkstencil=self.webpackChunkstencil||[]).push([[413],{4607:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return o},contentTitle:function(){return s},metadata:function(){return c},toc:function(){return d},default:function(){return p}});var a=n(7462),i=n(3366),r=(n(7294),n(3905)),l=["components"],o={},s="Backward compatability rules",c={unversionedId:"server/rules",id:"server/rules",isDocsHomePage:!1,title:"Backward compatability rules",description:"Stencil server by default performs following list of rules on file desciptorsets while uploading.",source:"@site/docs/server/rules.md",sourceDirName:"server",slug:"/server/rules",permalink:"/stencil/docs/server/rules",editUrl:"https://github.com/odpf/stencil/edit/master/docs/docs/server/rules.md",tags:[],version:"current",frontMatter:{},sidebar:"docsSidebar",previous:{title:"Stencil server",permalink:"/stencil/docs/server/overview"},next:{title:"api",permalink:"/stencil/docs/server/api"}},d=[{value:"FILE_NO_BREAKING_CHANGE",id:"file_no_breaking_change",children:[]},{value:"MESSAGE_NO_DELETE",id:"message_no_delete",children:[]},{value:"FIELD_NO_BREAKING_CHANGE",id:"field_no_breaking_change",children:[]},{value:"ENUM_NO_BREAKING_CHANGE",id:"enum_no_breaking_change",children:[]}],u={toc:d};function p(e){var t=e.components,n=(0,i.Z)(e,l);return(0,r.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"backward-compatability-rules"},"Backward compatability rules"),(0,r.kt)("p",null,"Stencil server by default performs following list of rules on file desciptorsets while uploading."),(0,r.kt)("h2",{id:"file_no_breaking_change"},"FILE_NO_BREAKING_CHANGE"),(0,r.kt)("p",null,"This rule checks for the following conditions,"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"File delete"),": no file has been deleted. Deleting a file will result in it's generated header file being deleted as well, which could break source code."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Package change"),": file has the same package value. Changing the package value will result in a lot of issues downstream in various languages"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Syntax change"),": file does not switch between proto2 and proto3, including going to/from unset (which assumes proto2) to set to proto3. Changing the syntax results in differences in generated code for many languages."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Options change"),": no change in java package, JAVA outer class name and go package file options.")),(0,r.kt)("h2",{id:"message_no_delete"},"MESSAGE_NO_DELETE"),(0,r.kt)("p",null,"This rule checks that messages are deleted from a given file. Deleting a message will delete the corresponding generated type, which could be referenced in source code. Instead of deleting these types, deprecate them."),(0,r.kt)("p",null,"For example,"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"message Foo {\n  option deprecated = true;\n}\n")),(0,r.kt)("h2",{id:"field_no_breaking_change"},"FIELD_NO_BREAKING_CHANGE"),(0,r.kt)("p",null,"This rule checks for the following conditions."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Field delete"),": checks that no message field is deleted. Deleting message field will result in the field being deleted from the generated source code, which could be referenced. Instead of deleting these, deprecate them.\nfor example,",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"message Bar {\n  string one = 1 [deprecated = true];\n}\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Number change"),": checks that field number for specific field is not changed. For example, you cannot change int64 foo = 1; to int64 bar = 1;. This affects generated source code, but also affects JSON compatibility as JSON uses field names for serialization. This does not affect wire compatibility, however we generally don't recommend changing field names."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Type change"),": checks that a field has the same type. Changing the type of a field can affect the type in the generated source code, wire compatibility, and JSON compatibility."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Label change"),": This checks that no field changes it's label, i.e. ",(0,r.kt)("inlineCode",{parentName:"li"},"optional"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"required"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"repeated"),". Changing to/from optional/required and repeated will be a generated source code and JSON breaking change. Changing to/from optional and repeated is actually not a wire-breaking change, however changing to/from optional and required is. Given that it's unlikely to be advisable in any situation to change your label, and that there is only one exception, we find it best to just outlaw this entirely."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"JSON name change"),": This checks that the json_name field option does not change, which would break JSON compatibility.")),(0,r.kt)("h2",{id:"enum_no_breaking_change"},"ENUM_NO_BREAKING_CHANGE"),(0,r.kt)("p",null,"This rule checks for the following conditions."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Enum delete"),": Checks that no enum is deleted from current version. Deleting an enum will delete the corresponding generated type, which could be referenced in source code. Instead of deleting these types, deprecate them. For example,"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"enum Foo {\n  option deprecated = true;\n  FOO_UNSPECIFIED = 0;\n  ...\n}\n\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Enum value delete"),": This checks that no enum value is deleted. Deleting an enum value will result in the corresponding value being deleted from the generated source code, which could be referenced. Instead of deleting these, deprecate them."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"enum Foo {\n  FOO_UNSPECIFIED = 0;\n  FOO_ONE = 1 [deprecated = true];\n}\n\n"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Enum value number change"),": This checks that a given enum value has the same name for each enum value number. For example You cannot change FOO_ONE = 1 to FOO_TWO = 1. Doing so will result in potential JSON incompatibilites and broken source code."))))}p.isMDXComponent=!0}}]);